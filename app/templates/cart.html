<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css" rel="stylesheet" />

    <script> // tailwind.config
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { "50": "#eff6ff", "100": "#dbeafe", "200": "#bfdbfe", "300": "#93c5fd", "400": "#60a5fa", "500": "#3b82f6", "600": "#2563eb", "700": "#1d4ed8", "800": "#1e40af", "900": "#1e3a8a", "950": "#172554" }
                    }
                },
                fontFamily: {
                    'body': [
                        'Inter',
                        'ui-sans-serif',
                        'system-ui',
                        '-apple-system',
                        'system-ui',
                        'Segoe UI',
                        'Roboto',
                        'Helvetica Neue',
                        'Arial',
                        'Noto Sans',
                        'sans-serif',
                        'Apple Color Emoji',
                        'Segoe UI Emoji',
                        'Segoe UI Symbol',
                        'Noto Color Emoji'
                    ],
                    'sans': [
                        'Inter',
                        'ui-sans-serif',
                        'system-ui',
                        '-apple-system',
                        'system-ui',
                        'Segoe UI',
                        'Roboto',
                        'Helvetica Neue',
                        'Arial',
                        'Noto Sans',
                        'sans-serif',
                        'Apple Color Emoji',
                        'Segoe UI Emoji',
                        'Segoe UI Symbol',
                        'Noto Color Emoji'
                    ]
                }
            }
        }
    </script>

</head>

<body class="bg-gray-100 font-sans leading-normal tracking-normal">

    <!-- Navbar -->
    <nav class="bg-white border-gray-200 px-4 py-2.5 rounded-lg shadow-md">
        <div class="flex flex-wrap justify-between items-center">
            <a href="/" class="flex items-center">
                <span class="self-center text-xl font-semibold whitespace-nowrap">üõçÔ∏è MyCart</span>
            </a>
            <div>
                <a href="/" class="text-gray-600 hover:text-gray-900 mr-4">Home</a>
                <a href="/logout" class="text-gray-600 hover:text-gray-900">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Cart Container -->
    <div class="container mx-auto mt-8 p-4 bg-white rounded-lg shadow-md">
        <h1 class="text-2xl font-semibold mb-4">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
        <div id="cart-container" class="divide-y divide-gray-200"></div>

        <div class="mt-6 flex justify-between items-center">
            <h3 id="cart-total" class="text-xl font-bold">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: ‡∏ø0</h3>
            <div class="flex gap-2">
                <button onclick="clearCart()"
                    class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
                <button onclick="checkout()"
                    class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-8 p-4 bg-white text-center text-gray-600">
        &copy; 2024 MyCart. All rights reserved.
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>
    <script>
        // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function displayCart() {
            let cart = JSON.parse(localStorage.getItem('cart')) || { cart: [], cart_total: 0 };
            let cartContainer = document.getElementById('cart-container');
            let cartTotal = document.getElementById('cart-total');

            cartContainer.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡∏°‡πà

            if (cart.cart.length === 0) {
                cartContainer.innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-gray-500">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>
                    </div>
                `;
                cartTotal.textContent = "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: ‡∏ø0";
                return;
            }

            cart.cart.forEach(item => {
                cartContainer.innerHTML += `
                    <div class="flex items-center justify-between py-4">
                        <div>
                            <h3 class="text-lg font-medium">${item.name}</h3>
                            <p class="text-gray-500">‡∏ø${item.price} x ${item.quantity}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <p class="text-lg font-semibold">‡∏ø${item.total}</p>
                            <button onclick="removeFromCart(${item.product_id})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">‡∏•‡∏ö</button>
                        </div>
                    </div>
                `;
            });

            cartTotal.textContent = `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: ‡∏ø${cart.cart_total}`;
        }

        // ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        function removeFromCart(productId) {
            let cart = JSON.parse(localStorage.getItem('cart')) || { cart: [], cart_total: 0 };
            cart.cart = cart.cart.filter(item => item.product_id !== productId);

            cart.cart_total = cart.cart.reduce((sum, item) => sum + item.total, 0);

            localStorage.setItem('cart', JSON.stringify(cart));
            displayCart();
        }

        // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        function clearCart() {
            localStorage.removeItem('cart');
            displayCart();
        }

        // ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
        function checkout() {
            let cart = JSON.parse(localStorage.getItem('cart')) || { cart: [], cart_total: 0 };

            if (cart.cart.length === 0) {
                alert('‚ùå ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤');
                return;
            }

            fetch('/checkout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(cart)
            })
                .then(response => response.json())
                .then(data => {
                    console.log('‚úÖ Checkout Success:', data);
                    localStorage.removeItem('cart');
                    alert('‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    displayCart();
                })
                .catch(error => {
                    console.error('‚ùå Checkout Error:', error);
                });
        }

        displayCart();
    </script>

</body>

</html>