<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>Roles Management</title>
</head>

<body class="bg-gray-100">
    <nav class="bg-white shadow-md p-4">
        <div class="max-w-screen-xl mx-auto flex justify-between items-center">
            <a href="/admin/dashboard" class="text-xl font-bold">üëë Roles Management</a>
            <a href="/" class="text-blue-500 hover:underline">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
        </div>
    </nav>

    <main class="p-8">
        <div class="mx-auto max-w-4xl">
            <h1 class="text-3xl font-bold text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</h1>
            <table class="min-w-full bg-white shadow-md rounded-lg mt-6">
                <thead>
                    <tr>
                        <th class="py-2 px-4 border-b">‡∏ä‡∏∑‡πà‡∏≠</th>
                        <th class="py-2 px-4 border-b">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
                        <th class="py-2 px-4 border-b">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                        <th class="py-2 px-4 border-b">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="roles-list">
                    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </tbody>
            </table>
        </div>
    </main>

    <script>
        function fetchRoles() {
            $.getJSON("/admin/users", function (data) {
                var rolesList = "";
                data.forEach(user => {
                    rolesList += `
                        <tr>
                            <td class="py-2 px-4 border-b">${user.name}</td>
                            <td class="py-2 px-4 border-b">
                                <select onchange="updateRole(${user.id}, this.value)">
                                    <option value="2" ${user.role?.role_id === 2 ? "selected" : ""}>Customer</option>
                                    <option value="1" ${user.role?.role_id === 1 ? "selected" : ""}>Employee</option>
                                </select>
                            </td>
                            <td class="py-2 px-4 border-b">
                                ${user.position ? `
                                    <select onchange="updatePosition(${user.id}, this.value)">
                                        <option value="1" ${user.position.position_id === 1 ? "selected" : ""}>Executive</option>
                                        <option value="2" ${user.position.position_id === 2 ? "selected" : ""}>Admin</option>
                                        <option value="3" ${user.position.position_id === 3 ? "selected" : ""}>Preparation Staff</option>
                                        <option value="4" ${user.position.position_id === 4 ? "selected" : ""}>Packing Staff</option>
                                    </select>
                                ` : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á'}
                            </td>
                            <td class="py-2 px-4 border-b">
                                <button onclick="deleteRole(${user.id})" class="bg-red-500 text-white px-2 py-1 rounded">‡∏•‡∏ö</button>
                            </td>
                        </tr>`;
                });
                $("#roles-list").html(rolesList);
            }).fail(function(error) {
                console.error("Error fetching roles:", error);
                alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ");
            });
        }
    
        function updateRole(userId, newRole) {
            $.ajax({
                url: `/admin/users/${userId}/update-role`,
                type: "PUT",
                contentType: "application/json",
                data: JSON.stringify({ role: newRole }),
                success: function () {
                    alert("‚úÖ ‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                    fetchRoles();
                },
                error: function () {
                    alert("‚ùå ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß");
                }
            });
        }
    
        function updatePosition(userId, newPosition) {
            $.ajax({
                url: `/admin/users/${userId}/update-position`,
                type: "PUT",
                contentType: "application/json",
                data: JSON.stringify({ position: newPosition }),
                success: function () {
                    alert("‚úÖ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                    fetchRoles();
                },
                error: function () {
                    alert("‚ùå ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß");
                }
            });
        }
    
        function deleteRole(userId) {
            if (confirm("‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                $.ajax({
                    url: `/admin/users/${userId}`,
                    type: "DELETE",
                    success: function () {
                        alert("‚úÖ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                        fetchRoles();
                    },
                    error: function () {
                        alert("‚ùå ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß");
                    }
                });
            }
        }
    
        $(document).ready(function () {
            fetchRoles();
        });
    </script>
</body>

</html>