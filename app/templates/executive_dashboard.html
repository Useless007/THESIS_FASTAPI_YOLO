<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Executive Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/flowbite@2.2.1/dist/flowbite.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">
  <!-- Navbar -->
  <nav class="bg-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <span class="text-2xl font-bold">üëî Executive Dashboard</span>
        </div>
        <div class="flex items-center space-x-4">
          <a href="/" class="text-gray-600 hover:text-gray-900">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
          <a href="/logout" class="text-gray-600 hover:text-gray-900">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Date Filter -->
    <div class="mb-6 flex justify-between items-center">
      <h2 class="text-2xl font-bold">‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h2>
      <select id="dateFilter" class="bg-white border rounded-lg px-4 py-2">
        <option value="today">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</option>
        <option value="week">7 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</option>
        <option value="month">30 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</option>
        <option value="year">‡∏õ‡∏µ‡∏ô‡∏µ‡πâ</option>
      </select>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <!-- ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏° -->
      <div class="bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-sm text-gray-500">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</p>
            <h3 id="totalSales" class="text-2xl font-bold">‡∏ø0</h3>
          </div>
          <span id="totalSalesChange" class="text-green-500 text-sm"></span>
        </div>
      </div>

      <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå -->
      <div class="bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-sm text-gray-500">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</p>
            <h3 id="totalOrders" class="text-2xl font-bold">0</h3>
          </div>
          <span id="totalOrdersChange" class="text-green-500 text-sm"></span>
        </div>
      </div>

      <!-- ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà -->
      <div class="bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-sm text-gray-500">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</p>
            <h3 id="newCustomers" class="text-2xl font-bold">0</h3>
          </div>
          <span id="newCustomersChange" class="text-green-500 text-sm"></span>
        </div>
      </div>

      <!-- ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï -->
      <div class="bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-start">
          <div>
            <p class="text-sm text-gray-500">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï</p>
            <h3 id="growthRate" class="text-2xl font-bold">0%</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
        <canvas id="salesChart"></canvas>
      </div>

      <!-- ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ</h3>
        <canvas id="topProductsChart"></canvas>
      </div>
    </div>

    <!-- Tables -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr class="border-b">
                <th class="text-left py-2">Order ID</th>
                <th class="text-left py-2">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                <th class="text-left py-2">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                <th class="text-left py-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              </tr>
            </thead>
            <tbody id="recentOrders">
              <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô -->
      <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr class="border-b">
                <th class="text-left py-2">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
                <th class="text-left py-2">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                <th class="text-left py-2">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th>
                <th class="text-left py-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
              </tr>
            </thead>
            <tbody id="staffPerformance">
              <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    let salesChart = null;
    let topProductsChart = null;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Dashboard
    async function loadDashboardData(period = 'today') {
      try {
        const authCookie = document.cookie.split('; ').find(row => row.startsWith('Authorization='));
        const token = authCookie ? authCookie.split('=')[1] : '';
        
        const response = await fetch(`/admin/api/executive/dashboard-data?period=${period}`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        const data = await response.json();
        updateDashboard(data);
      } catch (error) {
        console.error('Error loading dashboard data:', error);
      }
    }

    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô Dashboard
    function updateDashboard(data) {
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏´‡∏•‡∏±‡∏Å
      document.getElementById('totalSales').textContent = `‡∏ø${data.total_sales.toLocaleString()}`;
      document.getElementById('totalOrders').textContent = data.total_orders.toLocaleString();
      document.getElementById('newCustomers').textContent = data.new_customers.toLocaleString();
      document.getElementById('growthRate').textContent = `${data.growth_rate}%`;

      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏£‡∏¥‡∏á
      const salesChange = document.getElementById('totalSalesChange');
      const ordersChange = document.getElementById('totalOrdersChange');
      const customersChange = document.getElementById('newCustomersChange');
      
      salesChange.textContent = `${data.sales_change >= 0 ? '+' : ''}${data.sales_change}%`;
      salesChange.className = data.sales_change >= 0 ? 'text-green-500 text-sm' : 'text-red-500 text-sm';
      
      ordersChange.textContent = `${data.orders_change >= 0 ? '+' : ''}${data.orders_change}%`;
      ordersChange.className = data.orders_change >= 0 ? 'text-green-500 text-sm' : 'text-red-500 text-sm';
      
      customersChange.textContent = `${data.customers_change >= 0 ? '+' : ''}${data.customers_change}%`;
      customersChange.className = data.customers_change >= 0 ? 'text-green-500 text-sm' : 'text-red-500 text-sm';

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢
      createSalesChart(data.daily_sales);
      createTopProductsChart(data.top_products);

      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      updateRecentOrders(data.recent_orders);
      updateStaffPerformance(data.staff_performance);
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢
    function createSalesChart(data) {
      const ctx = document.getElementById('salesChart').getContext('2d');
      
      // ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
      if (salesChart) {
        salesChart.destroy();
      }
      
      salesChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.map(d => d.date),
          datasets: [{
            label: '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢',
            data: data.map(d => d.amount),
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return '‡∏ø' + value.toLocaleString();
                }
              }
            }
          }
        }
      });
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ
    function createTopProductsChart(data) {
      const ctx = document.getElementById('topProductsChart').getContext('2d');
      
      // ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
      if (topProductsChart) {
        topProductsChart.destroy();
      }
      
      topProductsChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: data.map(d => d.name),
          datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ',
            data: data.map(d => d.quantity),
            backgroundColor: 'rgb(59, 130, 246)',
            borderColor: 'rgb(59, 130, 246)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    }

    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    function updateRecentOrders(orders) {
      const tbody = document.getElementById('recentOrders');
      tbody.innerHTML = orders.map(order => `
        <tr class="border-b">
          <td class="py-2">#${order.id}</td>
          <td class="py-2">${order.customer}</td>
          <td class="py-2">‡∏ø${order.total.toLocaleString()}</td>
          <td class="py-2">
            <span class="px-2 py-1 rounded-full text-xs ${getStatusColor(order.status)}">
              ${getStatusText(order.status)}
            </span>
          </td>
        </tr>
      `).join('');
    }

    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
    function updateStaffPerformance(staff) {
      const tbody = document.getElementById('staffPerformance');
      tbody.innerHTML = staff.map(s => `
        <tr class="border-b">
          <td class="py-2">${s.name}</td>
          <td class="py-2">${s.orders_handled}</td>
          <td class="py-2">${s.avg_time} ‡∏ô‡∏≤‡∏ó‡∏µ</td>
          <td class="py-2">‚≠ê ${s.rating}/5</td>
        </tr>
      `).join('');
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    function getStatusColor(status) {
      const colors = {
        'pending': 'bg-yellow-100 text-yellow-800',
        'processing': 'bg-blue-100 text-blue-800',
        'completed': 'bg-green-100 text-green-800',
        'cancelled': 'bg-red-100 text-red-800'
      };
      return colors[status] || 'bg-gray-100 text-gray-800';
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
    function getStatusText(status) {
      const statusText = {
        'pending': '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
        'processing': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
        'completed': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
        'cancelled': '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      };
      return statusText[status] || status;
    }

    // Event Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö date filter
    document.getElementById('dateFilter').addEventListener('change', (e) => {
      loadDashboardData(e.target.value);
    });

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    loadDashboardData();

    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ
    setInterval(() => loadDashboardData(document.getElementById('dateFilter').value), 5 * 60 * 1000);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/flowbite@2.2.1/dist/flowbite.min.js"></script>
</body>
</html>